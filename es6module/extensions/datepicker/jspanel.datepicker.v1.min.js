import{jsPanel}from"../../jspanel.js";jsPanel.datepicker||(jsPanel.datepicker={version:"0.2.5",date:"2020-02-10 11:50",defaults:{locale:"en",months:1,showWeekNumbers:!0,ondateselect:void 0,onrangeselect:void 0},keyValue:void 0,weekcount:[6,10,14],daycount:[43,71,99],generateHTML(e){let a=document.createElement("div");a.className="jsPanel-cal-wrapper",a.innerHTML='<div class="jsPanel-cal-sub jsPanel-cal-clear">&#9723;</div>\n                <div class="jsPanel-cal-sub jsPanel-cal-back">&#9204;</div>\n                <div class="jsPanel-cal-sub jsPanel-cal-month"></div>\n                <div class="jsPanel-cal-sub jsPanel-cal-forward">&#9205;</div>\n                <div class="jsPanel-cal-sub jsPanel-cal-reset">&#8634;</div>\n                <div class="jsPanel-cal-sub jsPanel-cal-blank3"></div>';for(let e=0;e<7;e++)a.innerHTML+=`<div class="jsPanel-cal-sub day-name day-name-${e}"></div>`;for(let t=0;t<this.weekcount[e.months-1];t++)a.innerHTML+=`<div class="jsPanel-cal-sub week week-${t}"></div>`;for(let t=1;t<this.daycount[e.months-1];t++)a.innerHTML+=`<div class="jsPanel-cal-sub day day-${t}" data-day="${t}"></div>`;return a},create(e,a={}){let t=a;a.config&&delete(t=Object.assign({},a.config,a)).config,((t=Object.assign({},this.defaults,t)).months<1||t.months>3)&&(t.months=1),e.selectedDays=new Set,e.selectedRange=new Set,e.deselectAllDays=(()=>{e.querySelectorAll(".jsPanel-cal-sub.day").forEach(e=>{e.classList.remove("selected","range")})}),e.restoreSelections=(()=>{let a=e.querySelectorAll(".jsPanel-cal-sub.day");if(a.forEach(a=>{e.selectedDays.has(a.dataset.date)&&a.classList.add("selected")}),e.selectedRange.size){let t=e.selectedRange.values().next().value.split("/");a.forEach(e=>{e.dataset.date>=t[0]&&e.dataset.date<=t[1]&&e.classList.add("selected","range")})}}),e.fill=(a=>{moment.locale(t.locale);let s=a||moment();s.locale(t.locale);let l=s.month(),n=s.date(1).weekday(),d=s.localeData(),c=e.querySelector(".jsPanel-cal-month");c.innerHTML=s.format("MMMM YYYY"),c.dataset.date=s.format("YYYY-MM-DD");let r=e.querySelectorAll(".jsPanel-cal-sub.day-name"),o=d.weekdaysMin();if(1===d.firstDayOfWeek()){for(let e=0,a=1;e<7;e++,a++)r[e].textContent=o[a];r[6].textContent=o[0],r[5].classList.add("weekend"),r[6].classList.add("weekend")}else{for(let e=0;e<7;e++)r[e].textContent=o[e];r[0].classList.add("weekend"),r[6].classList.add("weekend")}let i=s.subtract(++n,"days");e.querySelectorAll(".jsPanel-cal-sub.day").forEach(e=>{e.classList.remove("today","notInMonth");let a=i.add(1,"days");e.textContent=a.format("D"),e.dataset.date=s.format("YYYY-MM-DD"),a.month()!==l?e.classList.add("notInMonth"):e.dataset.date===moment().format("YYYY-MM-DD")&&e.classList.add("today")}),t.showWeekNumbers?e.querySelectorAll(".jsPanel-cal-sub.week").forEach((a,t)=>{a.textContent=moment(e.querySelector(`.jsPanel-cal-sub.day-${7*(t+1)}`).dataset.date).week()}):e.querySelector(".jsPanel-cal-wrapper").style.gridTemplateColumns="0fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr"});let s=this.generateHTML(t);s.classList.add(`month-count-${t.months}`),e.append(s),e.fill();let l,n=e.querySelector(".jsPanel-cal-sub.jsPanel-cal-month");return e.querySelector(".jsPanel-cal-sub.jsPanel-cal-back").addEventListener("click",a=>{a.preventDefault();let t=jsPanel.datepicker.keyValue||1;e.fill(moment(n.dataset.date).subtract(t,"months")),e.deselectAllDays(),e.restoreSelections()}),e.querySelector(".jsPanel-cal-sub.jsPanel-cal-forward").addEventListener("click",a=>{a.preventDefault();let t=jsPanel.datepicker.keyValue||1;e.fill(moment(n.dataset.date).add(t,"months")),e.deselectAllDays(),e.restoreSelections()}),e.querySelector(".jsPanel-cal-sub.jsPanel-cal-reset").addEventListener("click",a=>{a.preventDefault(),e.fill(moment()),e.deselectAllDays(),e.restoreSelections()}),e.querySelector(".jsPanel-cal-sub.jsPanel-cal-clear").addEventListener("click",a=>{a.preventDefault(),e.deselectAllDays(),e.selectedDays.clear(),e.selectedRange.clear()}),s.addEventListener("click",a=>{a.preventDefault();const l=a.target,n=a.altKey,d=a.ctrlKey,c=a.shiftKey;if(l.classList.contains("day")){let r=l.classList.contains("selected");if(d||c||n?n||!d||c||(e.selectedRange.clear(),s.querySelectorAll(".day").forEach(e=>{e.classList.contains("selected")&&e.classList.contains("range")&&e.classList.remove("range","selected")}),r?(l.classList.remove("selected"),e.selectedDays.delete(l.dataset.date)):(l.classList.add("selected"),e.selectedDays.add(l.dataset.date))):(e.deselectAllDays(),e.selectedDays.clear(),r?l.classList.remove("selected"):(l.classList.add("selected"),e.selectedDays.add(l.dataset.date))),t.ondateselect&&"function"==typeof t.ondateselect){let s=moment(l.dataset.date);t.ondateselect.call(e,e,s,a)}}}),s.addEventListener("pointerdown",a=>{a.preventDefault();const t=a.target,n=a.altKey,d=a.ctrlKey,c=a.shiftKey;let r=Number(a.target.dataset.day),o=Number(a.target.dataset.day),i=[r,r],y=a=>{a.preventDefault(),l=!0,e.selectedDays.size&&e.selectedDays.clear(),a.target.dataset.day&&(o=Number(a.target.dataset.day),i=[r,o].sort((e,a)=>e-a)),s.querySelectorAll(".day").forEach(e=>{let a=Number(e.dataset.day);a<i[0]||a>i[1]?e.classList.remove("selected","range"):e.classList.add("selected","range")}),e.selectedRange.clear(),e.selectedRange.add(s.querySelector(`.day-${i[0]}`).dataset.date+"/"+s.querySelector(`.day-${i[1]}`).dataset.date)};t.classList.contains("day")&&!n&&!d&&c&&(s.addEventListener("pointermove",y),s.addEventListener("pointerup",()=>{s.removeEventListener("pointermove",y)}))}),s.addEventListener("pointerup",a=>{l&&t.onrangeselect&&"function"==typeof t.onrangeselect&&(t.onrangeselect.call(e,e,e.selectedRange,a),l=void 0),l=void 0}),e}},document.addEventListener("keydown",e=>{e.key.match(/^[2-9]$/)?jsPanel.datepicker.keyValue=e.key:e.key.match(/^1$/)&&(jsPanel.datepicker.keyValue=12)}),document.addEventListener("keyup",()=>{jsPanel.datepicker.keyValue=void 0}));