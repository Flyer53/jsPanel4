import{jsPanel}from"../../jspanel.js";jsPanel.datepicker||(jsPanel.datepicker={version:"0.3.0",date:"2020-02-16 19:32",defaults:{locale:"en",startdate:void 0,months:1,showWeekNumbers:!0,ondateselect:void 0,onrangeselect:void 0,onselectionclear:void 0,callback:void 0},keyValue:void 0,generateHTML(){let e=document.createElement("div");e.className="jsPanel-cal-wrapper",e.innerHTML='<div class="jsPanel-cal-sub jsPanel-cal-clear">&#9723;</div>\n                <div class="jsPanel-cal-sub jsPanel-cal-back">&#9204;</div>\n                <div class="jsPanel-cal-sub jsPanel-cal-month"></div>\n                <div class="jsPanel-cal-sub jsPanel-cal-forward">&#9205;</div>\n                <div class="jsPanel-cal-sub jsPanel-cal-reset">&#8634;</div>\n                <div class="jsPanel-cal-sub jsPanel-cal-blank3"></div>\n                <div class="jsPanel-cal-sub day-name day-name-0"></div>\n                <div class="jsPanel-cal-sub day-name day-name-1"></div>\n                <div class="jsPanel-cal-sub day-name day-name-2"></div>\n                <div class="jsPanel-cal-sub day-name day-name-3"></div>\n                <div class="jsPanel-cal-sub day-name day-name-4"></div>\n                <div class="jsPanel-cal-sub day-name day-name-5"></div>\n                <div class="jsPanel-cal-sub day-name day-name-6"></div>';for(let a=0;a<6;a++)e.innerHTML+=`<div class="jsPanel-cal-sub week week-${a}"></div>`;for(let a=1;a<43;a++)e.innerHTML+=`<div class="jsPanel-cal-sub day day-${a}"></div>`;return e},fillMonth(e,a=moment()){moment.locale(e.options.locale);let t=moment(a)||moment(e.options.startdate);t.locale(e.options.locale);let s=t.month(),l=t.date(1).weekday(),d=t.localeData(),n=e.querySelector(".jsPanel-cal-month");n.innerHTML=t.format("MMMM YYYY"),n.dataset.date=t.format("YYYY-MM-DD");let r=e.querySelectorAll(".jsPanel-cal-sub.day-name"),c=d.weekdaysMin();if(1===d.firstDayOfWeek()){for(let e=0,a=1;e<7;e++,a++)r[e].textContent=c[a];r[6].textContent=c[0],r[5].classList.add("weekend"),r[6].classList.add("weekend")}else{for(let e=0;e<7;e++)r[e].textContent=c[e];r[0].classList.add("weekend"),r[6].classList.add("weekend")}let o=t.subtract(++l,"days"),i=e.querySelectorAll(".jsPanel-cal-sub.day");for(let e of i){e.classList.remove("today","notInMonth","selected","range","remove-border-radius-right","remove-border-radius-left");let a=o.add(1,"days");e.textContent=a.format("D"),e.dataset.date=t.format("YYYY-MM-DD"),a.month()!==s?e.classList.add("notInMonth"):e.dataset.date===moment().format("YYYY-MM-DD")&&e.classList.add("today")}e.options.showWeekNumbers&&e.querySelectorAll(".jsPanel-cal-sub.week").forEach((a,t)=>{a.textContent=moment(e.querySelector(`.jsPanel-cal-sub.day-${7*(t+1)}`).dataset.date).week()})},deselectAllDays(e){for(let a of e.querySelectorAll(".jsPanel-cal-sub.day"))a.classList.remove("selected","range","remove-border-radius-right","remove-border-radius-left")},restoreSelections(e){let a=e.querySelectorAll(".jsPanel-cal-sub.day");for(let t of a)e.selectedDays.has(t.dataset.date)&&t.classList.add("selected");if(e.selectedRange.size){let t=e.selectedRange.values().next().value.split("/");for(let e of a){let a=e.dataset.date;a>=t[0]&&a<=t[1]&&(e.classList.add("selected","range"),a===t[0]?e.classList.add("remove-border-radius-right"):a===t[1]?e.classList.add("remove-border-radius-left"):(a>t[0]||a<t[1])&&e.classList.add("remove-border-radius-right","remove-border-radius-left"))}}},create(e,a={}){e.style.display="flex",e.selectedDays=new Set,e.selectedRange=new Set;let t,s=Object.assign({},this.defaults,a);for(let a=0;a<s.months;a++)(t=this.generateHTML()).options=s,e.append(t),this.fillMonth(t,s.startdate),s.startdate=moment(s.startdate).add(1,"months");let l,d=e.querySelectorAll(".jsPanel-cal-wrapper");for(let a of d){for(let t of a.querySelectorAll(".jsPanel-cal-clear"))t.addEventListener("click",a=>{s.onselectionclear&&"function"==typeof s.onselectionclear&&s.onselectionclear.call(e,e,a),a.defaultPrevented||(jsPanel.datepicker.deselectAllDays(e),e.selectedDays.clear(),e.selectedRange.clear())});for(let t of a.querySelectorAll(".jsPanel-cal-back"))t.addEventListener("click",()=>{for(let e of d){let a=e.querySelector(".jsPanel-cal-month").dataset.date,t=moment(a).subtract(1,"months").format("YYYY-MM");jsPanel.datepicker.fillMonth(e,t)}jsPanel.datepicker.deselectAllDays(e),jsPanel.datepicker.restoreSelections(e)});for(let t of a.querySelectorAll(".jsPanel-cal-forward"))t.addEventListener("click",()=>{for(let e of d){let a=e.querySelector(".jsPanel-cal-month").dataset.date,t=moment(a).add(1,"months").format("YYYY-MM");jsPanel.datepicker.fillMonth(e,t)}jsPanel.datepicker.deselectAllDays(e),jsPanel.datepicker.restoreSelections(e)});for(let t of a.querySelectorAll(".jsPanel-cal-reset"))t.addEventListener("click",a=>{let t=a.target.closest(".jsPanel-cal-wrapper"),s=0;for(;t.previousSibling;)s++,t=t.previousSibling;let l=moment().subtract(s,"months");for(let e of d)jsPanel.datepicker.fillMonth(e,l),l=moment(l).add(1,"months");jsPanel.datepicker.deselectAllDays(e),jsPanel.datepicker.restoreSelections(e)})}return e.addEventListener("click",a=>{a.preventDefault();const t=a.target,l=a.altKey,d=a.ctrlKey,n=a.shiftKey;if(t.classList.contains("day")){let r=t.classList.contains("selected"),c=t.dataset.date;if(d||n||l){if(!l&&d&&!n){e.selectedRange.clear();for(let a of e.querySelectorAll(".day"))a.classList.contains("selected")&&a.classList.contains("range")&&a.classList.remove("range","selected");r?(t.classList.remove("selected"),e.selectedDays.delete(c)):(t.classList.add("selected"),e.selectedDays.add(c))}}else jsPanel.datepicker.deselectAllDays(e),e.selectedDays.clear(),r?t.classList.remove("selected"):(t.classList.add("selected"),e.selectedDays.add(c));s.ondateselect&&"function"==typeof s.ondateselect&&s.ondateselect.call(e,e,c,a)}}),e.addEventListener("pointerdown",a=>{a.preventDefault();const t=a.target,s=a.altKey,d=a.ctrlKey,n=a.shiftKey;let r=a.target.dataset.date,c=a.target.dataset.date,o=[r,r],i=a=>{a.preventDefault(),l=!0,e.selectedDays.size&&e.selectedDays.clear(),a.target.classList.contains("day")&&(c=a.target.dataset.date,o=[r,c].sort((e,a)=>moment(e).unix()-moment(a).unix()));for(let a of e.querySelectorAll(".day")){let e=a.dataset.date;a.classList.remove("remove-border-radius-right","remove-border-radius-left"),e<o[0]||e>o[1]?a.classList.remove("selected","range"):(a.classList.add("selected","range"),e===o[0]?a.classList.add("remove-border-radius-right"):e===o[1]?a.classList.add("remove-border-radius-left"):(e>o[0]||e<o[1])&&a.classList.add("remove-border-radius-right","remove-border-radius-left"))}e.selectedRange.clear(),e.selectedRange.add(e.querySelector(`.day[data-date="${o[0]}"]`).dataset.date+"/"+e.querySelector(`.day[data-date="${o[1]}"]`).dataset.date)};t.classList.contains("day")&&!s&&!d&&n&&(e.addEventListener("pointermove",i),e.addEventListener("pointerup",()=>{e.removeEventListener("pointermove",i)}))}),e.addEventListener("pointerup",a=>{l&&s.onrangeselect&&"function"==typeof s.onrangeselect&&(s.onrangeselect.call(e,e,e.selectedRange,a),l=void 0),l=void 0}),s.callback&&s.callback.call(e,e),e}},document.addEventListener("keydown",e=>{e.key.match(/^[2-9]$/)?jsPanel.datepicker.keyValue=e.key:e.key.match(/^1$/)&&(jsPanel.datepicker.keyValue=12)}),document.addEventListener("keyup",()=>{jsPanel.datepicker.keyValue=void 0}));